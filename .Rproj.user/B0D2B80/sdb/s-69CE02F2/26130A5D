{
    "contents" : "#########################################\n## ETL Australian data for PISA 2012\n#########################################\n\nlibrary(data.table)\nlibrary(plyr)\n\n\n#########################################\n## Columns to import\n#########################################\n\nidentifiers <- c(\"STRATUM\", \"SCHOOLID\", \"StIDStd\",\n                 \"ST03Q01\", \"ST03Q02\" # birth month, birth year\n                 )\n\ndemographics <- c(\"ST04Q01\", \"ESCS\", \"ausSTATE\", \"ausGEOLOC_3\", \"ausINDIG\")\n\nint_motivation <- c(\"ST29Q01\", \"ST29Q03\", \"ST29Q04\", \"ST29Q06\") # intrinsic motivation INTMAT\n\next_motivation <- c(\"ST29Q02\", \"ST29Q05\", \"ST29Q07\", \"ST29Q08\") # extrinsic motivation INSTMOT\n\nself_concept <- c(\"ST42Q02\", \"ST42Q04\", \"ST42Q06\", \"ST42Q07\", \"ST42Q09\") # SCMAT\n\nself_efficacy <- c(\"ST37Q01\", \"ST37Q02\", \"ST37Q03\", \"ST37Q04\", \"ST37Q05\", \"ST37Q06\", \"ST37Q07\", \"ST37Q08\") # MATHEFF\n\ncontrol_in_school <- c(\"ST91Q01\", \"ST91Q02\", \"ST91Q03\", \"ST91Q04\", \"ST91Q05\", \"ST91Q06\")\n\ncontrol_in_maths <- c(\"ST43Q01\", \"ST43Q02\", \"ST43Q03\", \"ST43Q04\", \"ST43Q05\", \"ST43Q06\")\n\nattr_failure <- c(\"ST44Q01\", \"ST44Q03\", \"ST44Q04\", \"ST44Q05\", \"ST44Q07\", \"ST44Q08\") # FAILMAT\n\nmaths_anxiety <- c(\"ST42Q01\", \"ST42Q03\", \"ST42Q05\", \"ST42Q08\", \"ST42Q10\") # ANXMAT\n\nsubj_norms <- c(\"ST35Q01\", \"ST35Q02\", \"ST35Q03\", \"ST35Q04\", \"ST35Q05\", \"ST35Q06\") # SUBNORM\n\ndispositions <- c(int_motivation, ext_motivation, self_concept,\n                  self_efficacy, control_in_school, control_in_maths, attr_failure,\n                  maths_anxiety, subj_norms)\n\nmaths_literacy <- paste0(\"PV\", 1:5, \"MATH\")\n\n\n#########################################\n## Load data\n#########################################\n\nd <- fread(\"Data/Raw/PISA2012_StdQ_AUS.dat\", \n           select = c(identifiers, demographics, dispositions, maths_literacy)\n)\n\n\n#########################################\n## Keep only rows where students saw all parts of the test\n#########################################\n\nall_seated_test <-\n  all_seated(d[, dispositions, with = F])\n\nd <- d[all_seated_test] # reduces rows from 14481 to 4752\n\n#########################################\n## Set missing values to NA\n#########################################\n\nstuq_dict <- fread(\"Data/Raw/StdQ_dictionary.dat\")\n\nstu <- missingPISA(d, stuq_dict)\n\n\n\n#########################################\n## Include cols for plausible value levels\n#########################################\n\npv_cutoffs <- c(0, 358, 420, 482, 545, 607, 669, 1000) # from 2014024_tables.pdf\n\nstu[, paste0(\"PV\", 1:5, \"MATH_LEVEL\") :=\n      llply(list(PV1MATH, PV2MATH, PV3MATH, PV4MATH, PV5MATH), \n            cut, breaks = pv_cutoffs, labels = F, include.lowest = T)]\n\n\n#########################################\n## Rename unclear cols (not disposition cols)\n#########################################\n\n\nsetnames(stu, c(\"ST03Q01\", \"ST03Q02\"), c(\"BIRTHMONTH\", \"BIRTHYEAR\"))\n\n\n\n#########################################\n## Rename state\n#########################################\n\n\nstates <- c(\"ACT\", \"VIC\", \"NSW\", \"QLD\", \"SA\", \"WA\", \"TAS\", \"NT\")\n\nfor(i in 1:8){\n  stu[ausSTATE == i, STATE := states[i]]\n}\n\n\n\n\n#########################################\n## Rename geolocation\n#########################################\n\ngeolocs <- c(\"Urban\", \"Provincial\", \"Rural\")\n\nfor(i in 1:3){\n  stu[ausGEOLOC_3 == i, GEOLOC := geolocs[i]]\n}\n\n\n\n\n#########################################\n## Rename gender\n#########################################\n\nmfs <- c(\"Female\", \"Male\")\n\nfor(i in 1:2){\n  stu[ST04Q01 == i, GENDER := mfs[i]]\n}\n\n\n#########################################\n## Rename indig\n#########################################\n\nindig <- c(\"Indigenous\", \"Non-indigenous\")\nstu$INDIG <- \"Indigenous\"\nstu[ausINDIG == 0, INDIG := \"Non-indigenous\"]\n\n\n#########################################\n## Rename ESCS (4 is the top quartile)\n#########################################\n\nstu[is.na(ESCS) | ESCS == 9999.0, \n    ESCS := mean(stu[ESCS != 9999.0, ESCS], na.rm = T)] # assume missing values cluster around mean\n\nescs_quantile <- quantile(stu$ESCS)\nstu[, ESCS_Q := 0]\n\nfor(i in 1:4) {\n  stu[ESCS >= escs_quantile[i], ESCS_Q := i]\n}\n\n\n#########################################\n## Clear unused cols\n#########################################\n\nstu[, `:=`(ausSTATE = NULL,\n           ausGEOLOC_3 = NULL,\n           ST04Q01 = NULL,\n           ausINDIG = NULL)]\n\n\n#########################################\n## Impute missing disposition data using collaborative filtering\n#########################################\n\n\n\n\n\n\n\n\n\n",
    "created" : 1463279482834.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "325093341",
    "id" : "26130A5D",
    "lastKnownWriteTime" : 1463321137,
    "path" : "C:/Users/Jason/Projects/pisa-dispositions/Scripts/1_ETL.R",
    "project_path" : "Scripts/1_ETL.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}